# Amazon Elastic Container Service (ECS) #compute #ecs
collapsed:: true
	- [ECS | Resources | hashicorp/aws | Terraform | Terraform Registry](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_account_setting_default)
	- Based on [Docker](https://www.docker.com/)
	- **Use cases**
	  collapsed:: true
		- **Run microservices**
			- Run multiple Docker containers on the same machine
			- Easy *Service Discovery* features to enhance comms
			- Auto Scaling capability
			- Direct integration with ALB and NLB
		- **Run Batch Processing / Scheduled Tasks**
			- Schedule ECS tasks to run on On-Demand / Reserved / Spot instances
		- **Migrate Apps to the cloud**
			- Dockerize legacy apps running on-prem
	- **Concepts**
	  collapsed:: true
		- **ECS Cluster** -> logical grouping of EC2 instances
		- **ECS Service** -> defines how many tasks should run and how they should be run
		- **Task Definitions** -> metada in JSON form to tell ECS how to run a Docker container
		- **ECS Task** -> an instance of a task definition, a running Docker container(s)
		- **ECS IAM Roles**
			- **EC2 Instance Profile** -> used by the EC2 instance (call ECS API, send logs,...)
			- **ECS Task IAM Role** -> allow each task to have a specific role (make API calls to specific services)
	- **ALB integration**
	  collapsed:: true
		- **Dynamic Port Mapping** -> Allows you to run multiple instances of the same app on the same EC2 instance. The ALB find the right port on your EC2 Instances. Each ECS task has a specific instance port assigned
			- Use cases -> Increase resiliency, max. CPU usage
			- Ability to perform rolling upgrades without impacting app up-time
	- **AWS Fargate**
	  collapsed:: true
		- No EC2 instances to manage -> *serverless*
			- To scale, just increase the number of tasks
	- **Security & Networking**
	  collapsed:: true
		- Inject secrets and configuration as environment variables -> Integration with SSM Parameter Store and Secrets Manager
		- Types of network
			- **none** -> no network connectivity, no port mappins
			- **bridge** -> uses Docker's virtual container-based network
			- **host** -> bypass Docker's network, uses the underlying host network interface
			- **awsvpc** -> Ddefault mode for Fargate tasks
				- Every task launched on the instance get its own ENI and private IP address
				- Simplify management, security, monitoring, etc.
	- **Service Auto Scaling**
	  collapsed:: true
		- Automatically increase/decrease the desired number of tasks
		- Leverages in **AWS Application Auto Scaling**
			- **Target Tracking** -> scale based on CloudWatch metric target value
			- **Step Scaling** -> scale based on a specified CloudWatch alarm
			- **Scheduled Scaling** -> scale based on a specified date/time (predictable changes)
		- CPU and **RAM** is tracked by CloudWatch at the ECS Service level
		- Fargate Auto Scaling is much easier to setup
	- **Spot Instances**
	  collapsed:: true
		- ECS Classic
		  collapsed:: true
			- Underlying EC2 instances as Spot Instances (managed by an ASG)
			- Instances may go into draining mode to remove running tasks
			- Good for cost savings, but will impact reliability
		- AWS Fargate
		  collapsed:: true
			- Specify minimum of tasks for on-demand baseline workload
			- Add tasks running on FARGATE_SPOT for cost-savings (can be reclaimed by AWS)
			- Fargate scales well based on load
- # Amazon Elastic Container Registry (ECR) #compute #ecr
  collapsed:: true
	- [ECR| Resources | hashicorp/aws | Terraform | Terraform Registry](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_account_setting)
	- Store and manage Docker images on AWS
	- **[Public](https://gallery.ecr.aws) and private repository**
	- Fully intregrated with ECS
	- Access is controlled through IAM
	  collapsed:: true
		- Permission errors => check IAM policy
	- Supports image vulnerability scanning, versioning, image tags, image lifecycle,...
	- **Cross-Region Replication**
	  collapsed:: true
		- Private registries supports both cross-region and cross-account replication
	- **Images scanning**
	  collapsed:: true
		- Manual scan or *Scan on Push*
		- Basic -> Common CVEs
		- Enhanced -> Leverages Amazon Inspector
		- Scan results can be retrieved from withing the AWS console